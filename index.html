<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">

    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
        }

        /* UI verticale */
        .ui {
            position: fixed;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }

        .ui button,
        .dev-ui button {
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-size: 14px;
            background: #6a1b9a;
            color: white;
        }

        /* DEV UI */
        .dev-ui {
            position: fixed;
            left: 12px;
            bottom: 12px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }
    </style>
</head>

<body>

<!-- UI -->
<div class="ui">
    <button onclick="nextHat()">üé© Hat</button>
    <button onclick="nextGloves()">üß§ Gloves</button>
    <button onclick="nextScarf()">üß£ Scarf</button>
    <button onclick="randomize()">üé≤ Random</button>
    <button onclick="resetAll()">‚ùå None</button>
</div>

<div class="dev-ui">
    <button onclick="toggleDev()">DEV</button>
</div>

<a-scene
        embedded
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false;">

    <!-- Marker -->
    <a-marker preset="hiro" id="marker">
        <a-entity id="snowman-ar"
                  gltf-model="assets/snowman.glb"
                  scale="0.5 0.5 0.5">
        </a-entity>
    </a-marker>

    <!-- DEV MODE -->
    <a-entity id="snowman-dev"
              gltf-model="assets/snowman.glb"
              position="0 0 -1"
              scale="0.5 0.5 0.5"
              visible="false">
    </a-entity>

    <a-entity camera></a-entity>
</a-scene>

<script>
    let snowman;
    let hats = [], gloves = [], scarves = [];
    let h = -1, g = -1, s = -1;
    let dev = false;

    function initAccessories(model) {
        const body = model.getObject3D('mesh').getObjectByName('body_snowman');

        body.children.forEach(child => {
            child.visible = false;

            if (child.name.startsWith('hat_')) hats.push(child);
            if (child.name.startsWith('gloves_')) gloves.push(child);
            if (child.name.startsWith('scarf_')) scarves.push(child);
        });
    }

    function showOnly(list, index) {
        list.forEach((m, i) => m.visible = i === index);
    }

    AFRAME.scenes[0].addEventListener('model-loaded', e => {
        snowman = e.target;
        initAccessories(snowman);
    });

    /* Controls */
    function nextHat() {
        h = (h + 1) % hats.length;
        showOnly(hats, h);
    }

    function nextGloves() {
        g = (g + 1) % gloves.length;
        showOnly(gloves, g);
    }

    function nextScarf() {
        s = (s + 1) % scarves.length;
        showOnly(scarves, s);
    }

    function resetAll() {
        hats.concat(gloves, scarves).forEach(m => m.visible = false);
        h = g = s = -1;
    }

    function randomize() {
        h = Math.floor(Math.random() * hats.length);
        g = Math.floor(Math.random() * gloves.length);
        s = Math.floor(Math.random() * scarves.length);

        showOnly(hats, h);
        showOnly(gloves, g);
        showOnly(scarves, s);
    }

    function toggleDev() {
        dev = !dev;
        document.getElementById('marker').setAttribute('visible', !dev);
        document.getElementById('snowman-ar').setAttribute('visible', !dev);
        document.getElementById('snowman-dev').setAttribute('visible', dev);
    }
</script>

</body>
</html>
