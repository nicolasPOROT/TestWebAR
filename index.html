<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

    <!-- AR.js -->
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: sans-serif;
        }

        .ui-vertical {
            position: fixed;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 14px;
            z-index: 999;
        }

        .control {
            background: rgba(0,0,0,0.65);
            border-radius: 16px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            color: white;
        }

        button {
            width: 44px;
            height: 44px;
            font-size: 20px;
            border-radius: 50%;
            border: none;
        }
    </style>
</head>

<body>

<div class="ui-vertical">

    <div class="control">
        <div>üé©</div>
        <button onclick="prevHat()">‚¨ÜÔ∏è</button>
        <button onclick="nextHat()">‚¨áÔ∏è</button>
    </div>

    <div class="control">
        <div>üß£</div>
        <button onclick="prevScarf()">‚¨ÜÔ∏è</button>
        <button onclick="nextScarf()">‚¨áÔ∏è</button>
    </div>

    <div class="control">
        <div>üß§</div>
        <button onclick="prevGloves()">‚¨ÜÔ∏è</button>
        <button onclick="nextGloves()">‚¨áÔ∏è</button>
    </div>

    <div class="control">
        <div>üé≤</div>
        <button onclick="randomize()">Random</button>
    </div>

</div>

<a-scene
        embedded
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false;">

    <a-marker preset="hiro">

        <!-- Snowman UNIQUE -->
        <!-- Scale x2 -->
        <a-entity
                id="snowman"
                gltf-model="assets/snowman.glb"
                scale="2 2 2"> <!-- anciennement 0.5 0.5 0.5, maintenant x2 = 1 -->
        </a-entity>

    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<script>
    let hats = [];
    let gloves = [];
    let scarves = [];

    let hatIndex = -1;
    let gloveIndex = -1;
    let scarfIndex = -1;

    const snowmanEl = document.getElementById('snowman');

    snowmanEl.addEventListener('model-loaded', () => {
        const mesh = snowmanEl.getObject3D('mesh');
        if (!mesh) return;

        const body = mesh.getObjectByName('body_snowman');
        if (!body) {
            console.error('body_snowman introuvable');
            return;
        }

        // Appliquer double-sided et transparence √† TOUTES les meshes du mod√®le
        body.traverse((child) => {
            if (child.isMesh) {
                child.material.side = THREE.DoubleSide;
                child.material.transparent = true;
            }
        });

        // R√©cup√®re tous les accessoires
        body.children.forEach(child => {
            child.visible = false;
            if (child.name.startsWith('hat_')) hats.push(child);
            if (child.name.startsWith('gloves_')) gloves.push(child);
            if (child.name.startsWith('scarf_')) scarves.push(child);
        });

        console.log('Hats:', hats.length, 'Gloves:', gloves.length, 'Scarves:', scarves.length);
    });

    function showOnly(list, index) {
        list.forEach((obj, i) => {
            obj.visible = i === index;
        });
    }

    function nextHat() { if (!hats.length) return; hatIndex = (hatIndex + 1) % hats.length; showOnly(hats, hatIndex); }
    function prevHat() { if (!hats.length) return; hatIndex = (hatIndex - 1 + hats.length) % hats.length; showOnly(hats, hatIndex); }
    function nextScarf() { if (!scarves.length) return; scarfIndex = (scarfIndex + 1) % scarves.length; showOnly(scarves, scarfIndex); }
    function prevScarf() { if (!scarves.length) return; scarfIndex = (scarfIndex - 1 + scarves.length) % scarves.length; showOnly(scarves, scarfIndex); }
    function nextGloves() { if (!gloves.length) return; gloveIndex = (gloveIndex + 1) % gloves.length; showOnly(gloves, gloveIndex); }
    function prevGloves() { if (!gloves.length) return; gloveIndex = (gloveIndex - 1 + gloves.length) % gloves.length; showOnly(gloves, gloveIndex); }

    function randomize() {
        if (hats.length) { hatIndex = Math.floor(Math.random() * hats.length); showOnly(hats, hatIndex); }
        if (scarves.length) { scarfIndex = Math.floor(Math.random() * scarves.length); showOnly(scarves, scarfIndex); }
        if (gloves.length) { gloveIndex = Math.floor(Math.random() * gloves.length); showOnly(gloves, gloveIndex); }
    }
</script>

</body>
</html>
